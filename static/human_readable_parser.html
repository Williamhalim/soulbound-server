<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quest Tree Parser</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    textarea { width: 100%; height: 200px; }
    #story { margin-top: 20px; }
    .choice-btn { display: block; margin-top: 10px; padding: 10px; font-size: 1em; }
  </style>
</head>
<body>

  <h1>Quest Tree Tester</h1>
  <textarea id="input" placeholder="Paste human-readable quest format here..."></textarea>
  <button onclick="start()">Parse & Start</button>

  <div id="story"></div>

  <script>
    let questTree = {};
    let currentQuestId = null;

    function parseHumanReadable(text) {
      const lines = text.split('\n');
      const tree = {};
      let currentNodeId = null;
      let currentNode = null;

      for (let line of lines) {
        line = line.trim();

        if (line.startsWith("Node:")) {
          if (currentNodeId !== null) {
            tree[currentNodeId] = currentNode;
          }
          currentNodeId = line.slice(5).trim();
          currentNode = {
            title: "",
            context: "",
            choices: {}
          };
        } else if (line.startsWith("Title:")) {
          currentNode.title = line.slice(6).trim();
        } else if (line.startsWith("Context:")) {
          currentNode.context = line.slice(8).trim();
        } else if (line.startsWith("Choice")) {
          const parts = line.split("->");
          if (parts.length === 2) {
            const choiceText = parts[0].split(":")[1].trim();
            const nextId = parts[1].replace("Node", "").trim();
            currentNode.choices[choiceText] = nextId;
          }
        }
      }

      if (currentNodeId !== null) {
        tree[currentNodeId] = currentNode;
      }

      return tree;
    }

    function updateStoryContext(quest, choice) {
      // You can add logs or game state updates here
      console.log("Chose:", choice.text, "-> Next Node:", choice.next);
    }

    function renderQuest() {
      const container = document.getElementById("story");
      container.innerHTML = "";

      const quest = questTree[currentQuestId];
      if (!quest) {
        container.textContent = "The story ends here.";
        return;
      }

      const titleEl = document.createElement("h2");
      titleEl.textContent = quest.title;
      container.appendChild(titleEl);

      const contextEl = document.createElement("p");
      contextEl.textContent = quest.context;
      container.appendChild(contextEl);

      Object.entries(quest.choices).forEach(([choiceText, nextId]) => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = choiceText;
        btn.onclick = () => {
          currentQuestId = nextId;
          updateStoryContext(quest, { text: choiceText, next: nextId });
          renderQuest();
        };
        container.appendChild(btn);
      });
    }

    function start() {
      const input = document.getElementById("input").value;
      questTree = parseHumanReadable(input);
      currentQuestId = Object.keys(questTree)[0]; // Start from first node
      renderQuest();
    }
  </script>

</body>
</html>
